### 缓存的种类

cookie、webstorage、以及IndexDB 存储的数据也称为缓存。 但是这是不严谨。cookie 的存在更多的是为了让服务器区别用户。webStorage和indexDB 则更多的是用在保存具体的数据和客户端存储大量结构化数据上面。



实际上 缓存只有一种。**请求资源的副本**。 

缓存的优点：

* 缓解服务器的压力(不用每次都去请求)
* 提升性能(打开本地资源速度当然比请求回来再打开要快得多)
* 减少带宽消耗



那么有一个问题。如果服务器中间代理有缓存怎么办。

**宏观上** 可以分为两类缓存。 私有缓存和共享缓存。 共享就是能被各级代理缓存的缓存。 私有缓存就是用户专享。

**微观上** 

* 浏览器缓存  当你再次去访问某个页面的时候能跟更快的响应

* 代理服务器缓存 

  缓存服务器不是客户端或者源服务器的一部分。他们村在于网络中。 请求路由必须经过它们才会生效 所以实际上你可以去手动设置浏览器的代理。 或者通过中间服务器来进行 转发。他是一个共享缓存  不只是为一个用户服务。 为大量的用户使用。 因此在减少相应事件和带宽使用方面很有效。 一个缓存可能被重用多次

* 网关缓存

  一般是由网站管理员自己部署。 CDNS 分布网关缓存到整个互联网。 并出售缓存服务给需要的网站

* 数据库缓存

  数据库缓存指的是 应用很复杂。 表也很复杂。 我们必须进行频繁数据查询。 一般就是把查询后的数据存到内存中。下一次查询直接从内存中取就ok。

* ​



## **浏览器的缓存策**略

**缓存的目标：**

- 一个检索请求的成功响应: 对于 GET请求，响应状态码为：200，则表示为成功。一个包含例如HTML文档，图片，或者文件的响应；
- 不变的重定向: 响应状态码：301；
- 可用缓存响应：响应状态码：304，这个存在疑问，Chrome会缓存304中的缓存设置，Firefox；
- 错误响应: 响应状态码：404 的一个页面；
- 不完全的响应: 响应状态码 206，只返回局部的信息；
- 除了 GET 请求外，如果匹配到作为一个已被定义的cache键名的响应；

浏览器对于缓存的处理是根据第一次请求资源时返回的响应头来确定。 根据**响应头 ! 响应头! 响应头！**



```
Age:23146
Cache-Control:max-age=2592000
Date:Tue, 28 Nov 2017 12:26:41 GMT
ETag:W/"5a1cf09a-63c6"
Expires:Thu, 28 Dec 2017 05:27:45 GMT
Last-Modified:Tue, 28 Nov 2017 05:14:02 GMT
Vary:Accept-Encoding
```



### 强缓存阶段

Expires: 是HTTP/1.0 的缓存字段。 规定了缓存过期的一个绝对时间。 

Cache-Control: max-age=2592000 是HTTP1.1 

优先级高于低的 max-age > Expires.

这就是**强缓存阶段**，当浏览器再次试图访问这个CSS文件，发现有这个文件的缓存，那么就判断根据上一次的响应判断是否过期，如果没过期，使用缓存。加载文件

Chrome 就是 200 (from disk cache)或是200 OK (from memory cache)



**多说一点：**关于缓存是从磁盘中获取还是从内存中获取，查找了很多资料，得出了一个较为可信的结论：Chrome会根据本地内存的使用率来决定缓存存放在哪，如果内存使用率很高，放在磁盘里面，内存的使用率很高会暂时放在内存里面。这就可以比较合理的解释了为什么同一个资源有时是from memory cache有时是from disk cache的问题了。



## 协商缓存阶段

利用这两个字段浏览器可以进入**协商缓存阶段**，当浏览器再次试图访问这个CSS文件，发现缓存过期，于是会在本次请求的请求头里携带`If-Moified-Since`和`If-None-Match`这两个字段，服务器通过这两个字段来判断资源是否有修改，如果有修改则返回状态码**200和新的内容**，如果没有修改返回状态码**304**，浏览器收到200状态码，该咋处理就咋处理(相当于首次访问这个文件了)，发现返回**304**，于是知道了本地缓存虽然过期但仍然可以用，于是加载本地缓存。然后根据新的返回的响应头来设置缓存。(这一步有所差异，发现不同浏览器的处理是不同的，chrome会为304设置缓存，firefox则不会)



![border](https://pic2.zhimg.com/v2-381046a9d1c0c104669140c28f0d5cdd_r.jpg)